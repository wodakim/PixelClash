<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    
    <title>Pixel Clash: Launch Edition</title>
    <!-- <link rel="manifest" href="manifest.json"> -->
    <!-- <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet"> -->
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="notification-overlay" style="display:none;">
    <div class="notification-box">
        <h3 id="notif-title" style="color:#f1c40f; margin-top:0;">INFO</h3>
        <p id="notif-message" style="line-height:1.5; font-size:0.7rem; color:#fff;">Message</p>
        <button class="pixel-btn" onclick="closeNotification()">OK</button>
    </div>
</div>

<div id="card-info-overlay">
    <div style="position:relative; display:flex; flex-direction:column; align-items:center;">
        <canvas id="info-card-preview"></canvas>
        <h2 id="info-card-name" style="color:#f1c40f; margin:10px 0; text-shadow: 2px 2px 0 #000;">NAME</h2>
        <div id="info-card-stats" style="font-size:0.7rem; line-height:1.8; text-align:center; background:rgba(0,0,0,0.8); padding:10px; border:2px solid #555; max-width:250px;"></div>
        <p style="font-size:0.5rem; color:#aaa; margin-top:20px;" data-lang="close_hint">TOUCHER POUR FERMER</p>
    </div>
</div>

<div id="skin-modal" style="display:none;">
    <h2 style="color:#f1c40f; text-shadow:2px 2px 0 #000;" data-lang="summoning">INVOCATION...</h2>
    <canvas id="skin-canvas" width="64" height="64" style="border:4px solid white; margin:20px; image-rendering:pixelated; transform:scale(2);"></canvas>
    <h3 id="skin-name" style="line-height:1.5;">SKIN NAME</h3>
    <button class="pixel-btn" onclick="closeSkinModal()" data-lang="awesome">SUPER !</button>
</div>

<div id="roulette-modal" style="display:none;">
    <h2 id="roulette-title" style="color:#f1c40f; text-shadow:2px 2px 0 #000; margin-bottom:10px;" data-lang="summoning">OUVERTURE...</h2>

    <div class="roulette-container">
        <div class="roulette-cursor"></div>
        <div class="roulette-tape" id="roulette-tape">
        </div>
    </div>

    <div id="roulette-result" style="display:none; flex-direction:column; align-items:center; width:100%;">
        <canvas id="roulette-canvas" width="64" height="64" style="border:4px solid white; margin:10px; image-rendering:pixelated; transform:scale(1.5); box-shadow:0 0 20px white;"></canvas>
        <h3 id="roulette-name" style="line-height:1.5; color:#f1c40f;">CARD NAME</h3>
        <div id="roulette-rarity" style="font-size:0.7rem; margin-bottom:15px; color:#aaa;">RARITY</div>
        <button class="pixel-btn" onclick="closeRoulette()" data-lang="awesome">SUPER !</button>
    </div>
</div>

<div id="confirm-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:400; flex-direction:column; justify-content:center; align-items:center;">
    <div class="confirm-box">
        <h3 id="confirm-title" style="color:#e74c3c; margin-top:0; text-shadow:2px 2px 0 #000;">CONFIRMATION</h3>
        <p id="confirm-message" style="line-height:1.5; font-size:0.7rem; color:#fff; margin-bottom:20px;">√ätes-vous s√ªr ?</p>
        <div style="display:flex; gap:10px; width:100%; justify-content:center;">
            <button class="pixel-btn green" id="btn-confirm-yes" style="width:100px; margin:0;">OUI</button>
            <button class="pixel-btn" id="btn-confirm-no" style="width:100px; margin:0; background:#7f8c8d; border-color:#555;">NON</button>
        </div>
    </div>
</div>

<div id="settings-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:250; flex-direction:column; justify-content:center; align-items:center;">
    <div style="background:#2c3e50; padding:20px; border:4px solid white; text-align:center; min-width:280px;">
        <h2 style="color:#f1c40f; margin-bottom:20px; text-shadow:2px 2px 0 #000;" data-lang="settings">PARAM√àTRES</h2>

        <button class="pixel-btn blue" id="btn-lang" onclick="switchLanguage()" style="width:100%; margin:10px 0;">LANG: FR</button>
        <button class="pixel-btn purple" id="btn-theme" onclick="toggleDayNight()" style="width:100%; margin:10px 0;">THEME: DARK</button>
        <button class="pixel-btn" onclick="confirmReset()" style="width:100%; margin:10px 0; background:#c0392b;" data-lang="reset_data">RESET DATA</button>

        <button class="pixel-btn" onclick="toggleSettings()" style="width:100%; margin-top:20px; background:#95a5a6; border-color:#7f8c8d;" data-lang="close">FERMER</button>
    </div>
</div>

<!-- LEADERBOARD DRAWER (Parchemin) -->

<div id="matchmaking-screen" class="screen hidden" style="z-index: 150; justify-content: center; align-items: center; text-align: center; background:#111;">
    <h2 style="color:white; margin-bottom: 30px; animation: pop 1s infinite alternate;" data-lang="searching">RECHERCHE...</h2>
    <div class="spinner"></div>
    <div id="mm-player-found" style="margin-top:20px; color:#f1c40f; font-size: 1.2rem; min-height:50px;"></div>
    <div id="mm-difficulty-display" style="color:#aaa; font-size:0.6rem; margin-top:10px;"></div>
</div>

<div id="meta-view" class="screen">
    <button id="btn-settings-toggle" onclick="toggleSettings()" style="position:absolute; top:10px; right:60px; background:none; border:none; font-size:1.5rem; cursor:pointer; z-index:200; filter: drop-shadow(2px 2px 0 black);"><span data-icon="gear"></span></button>
    <button id="btn-audio-toggle" style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.5rem; cursor:pointer; z-index:200; filter: drop-shadow(2px 2px 0 black);"><span data-icon="sound_on"></span></button>

    <div id="tab-home" class="tab-content active">
        <!-- PROFILE TOGGLE TAB (BOOKMARK RIBBON) -->
        <div id="profile-toggle" onclick="openProfileDrawer()" style="
            position:absolute; 
            top:150px; right:0; 
            width: 80px; height: 35px;
            background: #c0392b; 
            color: white; 
            border: 2px solid #fff; border-right:none;
            display: flex; align-items: center; justify-content: center; gap: 5px;
            cursor: pointer; 
            box-shadow: -2px 4px 5px rgba(0,0,0,0.5); 
            z-index: 550; /* Above drawer (500) */
            clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%, 15% 50%);
            padding-left: 15px;
            transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        ">
            <span data-icon="user" class="pixel-icon small"></span>
            <span style="font-size:0.6rem; font-weight:bold; text-shadow:1px 1px 0 #000;">PROFIL</span>
        </div>

        <h1 style="color:#f1c40f; text-shadow:4px 4px 0 #000, 0 0 20px #e67e22; text-align:center; font-size: 2.5rem; line-height: 1.5; margin-top:40px;">PIXEL<br>CLASH</h1>
        <p style="color:#fff; font-size:0.6rem; margin-bottom:20px;">VERSION 0.0.90</p>

        <div style="display:flex; gap:20px; margin: 20px; background:rgba(0,0,0,0.5); padding:10px; border-radius:8px; border:2px solid #555;">
            <div style="color:#f1c40f"><span data-icon="trophy"></span> <span id="ui-trophies">0</span></div>
            <div style="color:#e67e22"><span data-icon="gold"></span> <span id="ui-gold">0</span></div>
            <div style="color:#3498db"><span data-icon="gem"></span> <span id="ui-gems">0</span></div>
        </div>

        <div id="leaderboard-drawer">
            <div id="leaderboard-handle">
                <div class="pixel-scroll-icon"></div>
                <span style="font-size:0.6rem; color:#5d4037; font-weight:bold;">CLASSEMENT MONDIAL</span>
            </div>
            <div id="leaderboard-content" class="leaderboard-container">
                </div>
        </div>

        <button class="pixel-btn" id="btn-battle-start" style="font-size: 1.5rem; padding: 20px 40px; border-color:#c0392b; animation: pop 0.8s infinite alternate;" data-lang="battle">COMBAT !</button>

        <div style="margin-top:auto; border: 2px dashed #7f8c8d; padding: 15px; width: 90%; background: rgba(0,0,0,0.3); margin-bottom:80px;">
            <h3 style="color:#3498db; margin-top:0;" data-lang="update_title">NOUVEAU CONTENU</h3>
            <p style="font-size:0.5rem; line-height:1.6; text-align:left;" data-lang="update_desc">
                - Collection √† compl√©ter (27 Cartes)<br>
                - Gestion de Deck avanc√©e<br>
                - Syst√®me de raret√©
            </p>
        </div>
    </div>

    <div id="tab-deck" class="tab-content">
        <h2 data-lang="deck_title" style="margin-bottom: 5px;">MON DECK</h2>
        <p style="font-size:0.6rem; color:#aaa; margin-top:0; margin-bottom:10px;" data-lang="deck_subtitle">S√©lectionnez 5 √† 6 cartes <span style="font-size:0.6rem; color:#aaa;">(<span id="deck-size">0</span>/6)</span></p>
        
        <button class="pixel-btn purple" onclick="openBrainModal()" style="font-size:0.6rem; padding:5px 10px; margin-bottom: 10px;">IA BRAIN üß†</button>

        <!-- VISUAL DECK PREVIEW -->
        <div id="deck-visuals" style="width:90%; height:80px; background:#222; border:2px solid #555; margin-bottom:20px; display:flex; justify-content:center; align-items:flex-end; overflow:hidden; position:relative;">
            <!-- Canvas for rendering sprites -->
            <canvas id="deck-visuals-canvas" style="width:100%; height:100%;"></canvas>
        </div>

        <div id="deck-valid-msg" style="color:#e74c3c; font-size:0.6rem; margin-bottom:10px; display:none;">DECK INVALIDE (5 MIN)</div>

        <div id="collection" class="card-grid"></div>
    </div>

    <div id="tab-shop" class="tab-content">
        <h2 data-lang="shop_title">BOUTIQUE</h2>
        <p><span data-lang="gold">Or</span>: <span id="shop-gold">0</span></p>

        <div style="width:90%; border-bottom: 2px dashed #555; padding-bottom: 20px; margin-bottom: 20px; text-align:center; display:flex; flex-direction:column; gap:10px; align-items:center;">
            <button class="pixel-btn purple" onclick="openChest()" style="width:100%; max-width:300px;">
                <span data-lang="open_chest">COFFRE MYST√àRE</span><br>
                <span style="font-size:0.7rem; color:#f1c40f;">1000 <span data-icon="gold"></span></span>
            </button>
            
            <button class="pixel-btn blue" onclick="openModuleChest()" style="width:100%; max-width:300px;">
                <span data-lang="open_module_chest">COFFRE MODULES</span><br>
                <span style="font-size:0.7rem; color:#f1c40f;">500 <span data-icon="gold"></span></span>
            </button>
        </div>

        <div id="shop-rotation" style="display:flex; flex-direction:column; gap:10px; width:100%; align-items:center; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 2px dashed #555;"></div>

        <div id="shop-list" style="display:flex; flex-direction:column; gap:10px; width:100%; align-items:center;"></div>
    </div>

    <div id="tab-skins" class="tab-content">
        <h2 data-lang="skins_title">AR√àNES</h2>
        <p style="color:#3498db; margin-bottom: 20px;">Gemmes: <span data-icon="gem"></span> <span id="skin-gems">0</span></p>

        <div style="background:rgba(0,0,0,0.3); padding:20px; border:2px solid #34495e; text-align:center; margin-bottom:20px; width:90%;">
            <button class="pixel-btn purple" onclick="openGachaDraw()">
                <span data-lang="summon_skin">INVOCATION SKIN</span><br>
                <span style="font-size:0.7rem"><span data-icon="gem"></span> 10 GEMMES</span>
            </button>
        </div>

        <h3 style="margin-top:10px;" data-lang="my_collection">MA COLLECTION</h3>
        <div id="skin-list" style="width:100%; display:flex; flex-direction:column; align-items:center;"></div>
    </div>

    <div id="tab-social" class="tab-content" style="justify-content:center; align-items:center; text-align:center;">
        <h1 style="color:#95a5a6; font-size:2rem; margin-bottom:20px;"><span data-icon="construction"></span></h1>
        <h2 style="color:#fff; margin-bottom:10px;">EN CONSTRUCTION</h2>
        <p style="color:#aaa; font-size:0.6rem; max-width:80%; line-height:1.6;">
            Bient√¥t : Clans, Troph√©es Challenge &<br>R√©compenses Uniques !
        </p>
        <div style="display:flex; gap:20px; margin-top:40px;">
            <div style="display:flex; flex-direction:column; align-items:center;">
                <div style="font-size:2rem; margin-bottom:10px;"><span data-icon="clan"></span></div>
                <div style="font-size:0.5rem; color:#f1c40f;">CLANS</div>
            </div>
            <div style="display:flex; flex-direction:column; align-items:center;">
                <div style="font-size:2rem; margin-bottom:10px;"><span data-icon="trophy"></span></div>
                <div style="font-size:0.5rem; color:#f1c40f;">D√âFIS</div>
            </div>
        </div>
    </div>

    <div id="tab-kingdom" class="tab-content" style="padding:0; overflow:hidden;">
        <div style="width:100%; height:100%; position:relative; display:flex; flex-direction:column;">
            <!-- KINGDOM CANVAS -->
            <canvas id="kingdom-canvas" style="width:100%; height:100%; position:absolute; top:0; left:0; z-index:0; background:#27ae60;"></canvas>
            
            <!-- UI OVERLAY -->
            <div style="position:relative; z-index:10; pointer-events:none; width:100%; height:100%; display:flex; flex-direction:column;">
                
                <!-- TOP HEADER -->
                <div style="background:rgba(0,0,0,0.7); padding:10px; text-align:center; border-bottom:2px solid #fff; pointer-events:auto;">
                    <h2 style="margin:0; font-size:1.2rem; color:#f1c40f;">ROYAUME</h2>
                    <div style="font-size:0.7rem; color:#fff;">Production: <span id="k-rate">0</span> <span data-icon="gold"></span>/h</div>
                </div>

                <!-- COLLECT BUTTON -->
                <div style="position:absolute; top:80px; right:20px; pointer-events:auto;">
                     <button id="btn-collect-gold" class="pixel-btn green" onclick="collectKingdomGold()" style="padding:10px; font-size:0.7rem; display:none; animation: pop 1s infinite alternate;">
                        R√âCOLTER<br><span id="k-pending-gold">0</span> <span data-icon="gold"></span>
                     </button>
                </div>

                <!-- SLOTS BOTTOM DOCK -->
                <div style="margin-top:auto; background:rgba(44, 62, 80, 0.9); border-top:4px solid #34495e; padding:10px; pointer-events:auto; padding-bottom:10px; max-height: 40%;">
                    <h3 style="margin:0 0 10px 0; font-size:0.8rem; text-align:center; color:#ecf0f1;">ASSIGNATIONS</h3>
                    <div id="kingdom-slots" style="display:flex; justify-content:center; gap:10px; flex-wrap:wrap;">
                        <!-- Slots generated by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="navbar">
        <button class="nav-btn active" data-target="tab-home" data-lang="nav_home">ACCUEIL</button>
        <button class="nav-btn" data-target="tab-deck" data-lang="nav_deck">DECK</button>
        <button class="nav-btn" data-target="tab-shop" data-lang="nav_shop">SHOP</button>
        <button class="nav-btn" data-target="tab-kingdom">ROYAUME</button>
        <button class="nav-btn" data-target="tab-skins" data-lang="nav_skins">SKINS</button>
        <button class="nav-btn" data-target="tab-social">SOCIAL</button>
    </div>
</div>

<div id="game-view">
    <div id="game-arena-wrapper">
        <div class="ad-banner top">ADVERTISEMENT</div>
        <canvas id="game-canvas"></canvas>
        <div class="ad-banner bottom">ADVERTISEMENT</div>

        <div id="game-overlay-ui">
            <div class="hud-top">
                <div style="display:flex; gap:8px;">
                    <button id="btn-game-menu" class="pixel-btn blue" onclick="togglePauseGame()" style="padding: 5px 10px; font-size: 0.8rem; margin:0; width:40px; height:40px; pointer-events:auto; z-index:1000;">
                        ||
                    </button>
                    <button id="btn-audio-game" class="pixel-btn" style="padding: 5px 10px; font-size: 0.8rem; margin:0; width:40px; height:40px; background:#333; border-color:#555;">
                        <span data-icon="sound_on"></span>
                    </button>
                </div>

                <div class="score-board">
                    <div id="g-time" style="font-size:1.5rem;">03:00</div>
                    <div id="g-score" style="color:#f1c40f;">0 - 0</div>
                </div>

                <div class="elixir-mini-wrap" style="align-self: flex-end;">
                    <div class="elixir-mini-fill red" id="g-enemy-elixir-bar"></div>
                </div>
            </div>

            <div id="start-countdown-overlay" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); justify-content:center; align-items:center; z-index:50;">
                <div id="start-cnt-val" style="font-size:5rem; color:#f1c40f; text-shadow: 4px 4px 0 #000; animation: pop 0.5s infinite alternate;">5</div>
            </div>

            <div id="pause-menu-overlay" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:60; flex-direction:column; justify-content:center; align-items:center;">
                <h2 style="color:white; margin-bottom:10px;" data-lang="paused">PAUSE</h2>
                <p style="color:#aaa; font-size:0.7rem; margin-bottom:20px;">Reprise dans : <span id="pause-timer-val" style="color:#f1c40f;">30</span>s</p>

                <button class="pixel-btn green" onclick="resumeGame()" data-lang="resume">REPRENDRE</button>
                <button class="pixel-btn" onclick="surrenderGame()" data-lang="surrender">ABANDON</button>
            </div>
        </div>
    </div>

    <div id="game-controls-dock">
        <div id="g-msg"></div>
        <div class="elixir-bar-wrap">
            <div class="elixir-fill" id="g-elixir-bar"></div>
            <div class="elixir-txt" id="g-elixir-val">5</div>
        </div>
        <div class="battle-hand" id="battle-hand"></div>
    </div>

    <div id="drag-ghost"></div>

    <div id="game-over-modal">
        <h1 id="go-title" style="margin:10px 0; font-size:2rem; text-shadow:3px 3px 0 #000;">VICTOIRE</h1>
        <p id="go-rew" style="margin-bottom:20px; font-size: 0.8rem; line-height: 1.5; color:#444;"></p>
        <button class="pixel-btn" onclick="exitBattle()" data-lang="continue">CONTINUER</button>
    </div>
</div>

<div id="brain-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#2c3e50; z-index:300; flex-direction:column; align-items:center; padding-top:20px;">
    <h2 style="color:#f1c40f; text-shadow:2px 2px 0 #000; margin-bottom:5px;" data-lang="brain_title">IA BRAIN PUZZLE</h2>
    <div style="font-size:0.6rem; color:#bdc3c7; margin-bottom:10px;" data-lang="brain_subtitle">Glissez les modules pour booster l'IA (Gain++)</div>
    
    <!-- STATS PANEL -->
    <div id="brain-stats" style="background:rgba(0,0,0,0.5); padding:10px; border:1px solid #555; width:90%; display:flex; justify-content:space-around; font-size:0.6rem; margin-bottom:10px;">
        <div style="color:#e74c3c"><span data-lang="brain_stat_diff">DIFFICULT√â</span>: <span id="brain-stat-diff">0</span>%</div>
        <div style="color:#f1c40f"><span data-lang="brain_stat_gold">GAIN OR</span>: +<span id="brain-stat-gold">0</span>%</div>
    </div>

    <!-- GRID CONTAINER -->
    <div id="brain-grid-container" style="position:relative; background:#111; border:2px solid #555;">
        <!-- Generated by JS -->
    </div>

    <h3 style="color:#fff; font-size:0.8rem; margin:10px 0 5px 0;" data-lang="brain_inventory">INVENTAIRE</h3>
    <div id="brain-inventory" style="flex:1; width:100%; background:rgba(0,0,0,0.3); overflow-y:auto; display:flex; flex-wrap:wrap; justify-content:center; gap:10px; padding:10px;">
        <!-- Draggable items -->
    </div>

    <button class="pixel-btn" onclick="closeBrainModal()" style="margin:10px; width:90%;" data-lang="brain_validate">VALIDER & FERMER</button>
    
    <!-- GHOST FOR DRAGGING -->
    <div id="brain-drag-ghost" style="position:fixed; pointer-events:none; opacity:0.8; z-index:350; display:none;"></div>
</div>

<!-- OFFLINE MODE BUNDLE -->
<script src="js/pixel_clash_offline.js?v=2"></script>
<!-- <script type="module" src="js/main.js"></script> -->

</body>
</html>